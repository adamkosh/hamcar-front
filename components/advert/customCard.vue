<template>
  <div>
    <div class="advert" v-if="isMobile == false">
      <div class="advert__badge" v-if="false">
        <svg
          class="advert__safe-badge"
          width="20"
          height="24"
          viewBox="0 0 20 24"
          fill="none"
        >
          <path
            d="M17.3912 3.58107L10.7912 1.27631C10.2789 1.0974 9.72108 1.0974 9.20876 1.27631L2.60876 3.58107C1.64533 3.91751 1 4.82418 1 5.84467V13.5714C1 18.9277 6.22812 21.3362 8.88803 22.4986C9.59168 22.8061 10.4083 22.8061 11.112 22.4986C13.7719 21.3362 19 18.9277 19 13.5714V5.84467C19 4.82418 18.3547 3.9175 17.3912 3.58107Z"
            fill="#69CE91"
          ></path>
          <path
            d="M7 12L9 14L13 10"
            stroke="white"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          ></path>
        </svg>
        <svg
          class="advert__hamcar-badge"
          width="24"
          height="72"
          viewBox="0 0 24 72"
          fill="none"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M12.4924 21.0664C18.3056 24.2486 23.9998 29.3724 23.9998 35.9996C23.9997 42.6268 18.3056 47.7506 12.4924 50.9328C5.04812 55.0079 -3.97123e-07 62.9139 0 71.999L-3.14719e-06 -0.000236511C-3.14718e-06 -9.91821e-05 -1.04907e-06 4.57764e-05 -1.04907e-06 0.000183105C-6.51945e-07 9.0853 5.04812 16.9914 12.4924 21.0664Z"
            fill="#FF9E0B"
          ></path>
          <path
            d="M7.3461 34.1437C7.36902 33.3981 7.81612 32.7901 8.5269 32.5722C8.8135 32.4804 9.12302 32.4345 9.42109 32.423C11.8515 32.4116 14.2818 32.423 16.7122 32.4116C17.3313 32.4116 17.9503 32.3886 18.5694 32.3657C18.6267 32.3657 18.6955 32.3657 18.7528 32.3657C18.7757 32.3657 18.8101 32.3542 18.8445 32.3427C18.8445 32.033 18.8216 31.7348 18.8445 31.448C18.9019 30.863 18.7643 30.3583 18.2713 30.0027C18.2599 29.9912 18.2484 29.9683 18.2369 29.9453C15.1646 29.9453 12.0922 29.9453 9.01985 29.9453C8.67593 30.0027 8.32054 30.06 7.97662 30.1403C6.69265 30.4386 5.68381 31.1153 5.11061 32.3427C4.77815 33.0539 4.65205 33.811 4.62912 34.5796C4.61765 34.809 4.62912 35.0384 4.62912 35.2564C5.54624 35.2564 6.42897 35.2564 7.3461 35.2564C7.3461 34.8663 7.33463 34.4993 7.3461 34.1437Z"
            fill="white"
          ></path>
          <path
            d="M12.253 42.7597C13.0326 42.5418 13.7433 42.1862 14.3509 41.6356C15.0732 40.9702 15.4744 40.1329 15.7151 39.2037C15.8069 38.8596 15.8298 38.504 15.8871 38.1369C15.0044 38.1369 14.1904 38.1369 13.3536 38.1369C13.3306 38.2402 13.3192 38.3319 13.2848 38.4237C13.1013 39.0431 12.8262 39.6052 12.2874 40.0067C11.5881 40.5229 10.8085 40.5917 9.98312 40.4655C8.81379 40.2935 8.10302 39.5823 7.67885 38.5269C7.41518 37.8846 7.30054 37.2078 7.28907 36.4736C6.5783 36.4736 5.86753 36.4736 5.12237 36.4736C4.96187 36.4736 4.81284 36.4736 4.65234 36.4736C4.68674 36.8063 4.73259 37.1619 4.76698 37.506C4.8243 38.2057 4.99627 38.894 5.23701 39.5478C5.56947 40.4541 6.09681 41.2226 6.83051 41.8306C7.03686 42.0026 7.25468 42.1518 7.4725 42.2779C8.14888 42.6679 8.9055 42.8744 9.68506 42.9318C10.5449 43.0006 11.4161 43.0006 12.253 42.7597Z"
            fill="white"
          ></path>
        </svg>
      </div>
      <nuxt-link :to="link" class="advert__banner">
        <h-image
          :src="GetBitMapAdvertImage(advert.id, advert.imageName)"
          :alt="advert.imageName"
          class="advert__img"
        />
        <span
          class="advert__flag advert__flag--place"
          v-if="advert.isExhibition"
        >
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path
              d="M11.0515 0.795975L11.0852 0.04673L11.0515 0.795975ZM1.5 9.00349C1.5 10.6116 1.55208 11.8703 1.70439 12.8648C1.8567 13.8594 2.10092 14.5289 2.44161 15.0004C3.09186 15.9003 4.29205 16.3399 6.97144 16.4613L6.90356 17.9598C4.22281 17.8383 2.32925 17.406 1.22579 15.8789C0.689617 15.1369 0.391991 14.2041 0.221671 13.0919C0.0513383 11.9796 0 10.6269 0 9.0035L1.5 9.00349ZM6.97144 16.4613C7.58044 16.4889 8.25389 16.5 9 16.5V18C8.24041 18 7.54277 17.9887 6.90356 17.9598L6.97144 16.4613ZM6.1875 17.2105V14.8125H7.6875V17.2105H6.1875ZM9 16.5C9.74611 16.5 10.4196 16.4889 11.0286 16.4613L11.0964 17.9598C10.4572 17.9887 9.75959 18 9 18V16.5ZM11.0286 16.4613C13.7079 16.3399 14.9081 15.9003 15.5584 15.0004C15.8991 14.5289 16.1433 13.8594 16.2956 12.8648C16.4479 11.8703 16.5 10.6116 16.5 9.0035L18 9.00349C18 10.6269 17.9487 11.9796 17.7783 13.0919C17.608 14.2041 17.3104 15.1369 16.7742 15.8789C15.6707 17.406 13.7772 17.8383 11.0964 17.9598L11.0286 16.4613ZM11.8125 14.8125V17.2105H10.3125V14.8125H11.8125ZM9 8.25349C9.68804 8.25349 10.2688 8.04241 10.669 7.6767C11.0583 7.32099 11.3438 6.75881 11.3438 5.91105H12.8438C12.8438 7.12492 12.4197 8.10896 11.6808 8.78407C10.9529 9.44917 9.98677 9.75349 9 9.75349V8.25349ZM6.65625 5.91105C6.65625 6.75881 6.94167 7.32099 7.33098 7.6767C7.73123 8.04241 8.31196 8.25349 9 8.25349V9.75349C8.01323 9.75349 7.0471 9.44917 6.31917 8.78407C5.58031 8.10896 5.15625 7.12492 5.15625 5.91105H6.65625ZM6.98217 1.54522C4.29727 1.66583 3.09449 2.1048 2.44301 3.00467C2.10184 3.47592 1.85724 4.14527 1.7047 5.14015C1.55216 6.13498 1.5 7.39423 1.5 9.00349L0 9.0035C0 7.37897 0.0514069 6.02553 0.222024 4.91281C0.392632 3.80014 0.690791 2.86707 1.228 2.12504C2.33327 0.598356 4.22974 0.167355 6.91485 0.04673L6.98217 1.54522ZM6.94851 0.795975C7.6583 1.03825 7.65832 1.03819 7.65834 1.03814C7.65834 1.03814 7.65835 1.03811 7.65835 1.03811C7.65835 1.0381 7.65834 1.03815 7.65831 1.03823C7.65825 1.03841 7.65812 1.03877 7.65794 1.03932C7.65757 1.0404 7.65696 1.04221 7.65611 1.04473C7.6544 1.04978 7.65175 1.05766 7.64821 1.06825C7.64114 1.08945 7.63052 1.1215 7.61687 1.16343C7.58956 1.2473 7.55015 1.37053 7.50267 1.52528C7.4076 1.83515 7.28077 2.26946 7.15409 2.76585C6.89642 3.77556 6.65625 4.97873 6.65625 5.91105H5.15625C5.15625 4.78175 5.43721 3.42738 5.70067 2.39496C5.83456 1.87028 5.9683 1.41238 6.06865 1.0853C6.11888 0.921576 6.1609 0.79015 6.19059 0.69898C6.20543 0.653383 6.21721 0.617819 6.2254 0.593283C6.2295 0.581013 6.2327 0.571497 6.23494 0.564859C6.23606 0.561539 6.23694 0.558939 6.23757 0.557074C6.23789 0.556141 6.23814 0.555391 6.23834 0.554829C6.23843 0.554546 6.23851 0.55431 6.23858 0.554121C6.23861 0.554028 6.23865 0.553921 6.23866 0.553873C6.23869 0.553778 6.23872 0.553696 6.94851 0.795975ZM16.5 9.0035C16.5 7.39423 16.4478 6.13498 16.2953 5.14015C16.1428 4.14527 15.8982 3.47592 15.557 3.00467C14.9055 2.1048 13.7027 1.66584 11.0178 1.54522L11.0852 0.04673C13.7703 0.167356 15.6667 0.598358 16.772 2.12504C17.3092 2.86707 17.6074 3.80014 17.778 4.91281C17.9486 6.02553 18 7.37897 18 9.00349L16.5 9.0035ZM11.3438 5.91105C11.3438 4.97873 11.1036 3.77556 10.8459 2.76585C10.7192 2.26946 10.5924 1.83514 10.4973 1.52528C10.4499 1.37053 10.4104 1.24729 10.3831 1.16343C10.3695 1.1215 10.3589 1.08945 10.3518 1.06825C10.3483 1.05766 10.3456 1.04977 10.3439 1.04473C10.3431 1.04221 10.3424 1.0404 10.3421 1.03931C10.3419 1.03877 10.3418 1.03841 10.3417 1.03823C10.3417 1.03814 10.3417 1.0381 10.3417 1.0381C10.3417 1.03811 10.3417 1.03814 10.3417 1.03814C10.3417 1.03819 10.3417 1.03825 11.0515 0.795975C11.7613 0.553698 11.7613 0.553782 11.7613 0.553875C11.7614 0.553923 11.7614 0.554029 11.7614 0.554125C11.7615 0.554314 11.7616 0.554548 11.7617 0.554831C11.7619 0.555393 11.7621 0.556143 11.7624 0.557076C11.7631 0.558941 11.764 0.561543 11.7651 0.564861C11.7673 0.571499 11.7705 0.581015 11.7746 0.593285C11.7828 0.617823 11.7946 0.653385 11.8094 0.698982C11.8391 0.790152 11.8811 0.921577 11.9314 1.0853C12.0317 1.41238 12.1654 1.87029 12.2993 2.39496C12.5628 3.42738 12.8438 4.78175 12.8438 5.91105H11.3438ZM11.0178 1.54522C9.67575 1.48493 8.32426 1.48493 6.98217 1.54522L6.91485 0.04673C8.3018 -0.0155773 9.69821 -0.0155773 11.0852 0.04673L11.0178 1.54522ZM2.32561 9.75349H0.75V8.25349H2.32561V9.75349ZM15.6744 8.25349H17.25V9.75349H15.6744V8.25349ZM12.8438 5.91105C12.8438 6.58535 13.1655 7.15474 13.6944 7.57552C14.2329 8.00393 14.9619 8.25349 15.6744 8.25349V9.75349C14.636 9.75349 13.5747 9.39705 12.7605 8.74934C11.9368 8.09401 11.3438 7.11718 11.3438 5.91105H12.8438ZM6.65625 5.91105C6.65625 7.11718 6.06316 8.09401 5.23946 8.74934C4.42533 9.39705 3.36404 9.75349 2.32561 9.75349V8.25349C3.03807 8.25349 3.7671 8.00393 4.30557 7.57552C4.83446 7.15474 5.15625 6.58535 5.15625 5.91105H6.65625ZM9 12C10.5533 12 11.8125 13.2592 11.8125 14.8125H10.3125C10.3125 14.0876 9.72487 13.5 9 13.5V12ZM6.1875 14.8125C6.1875 13.2592 7.4467 12 9 12V13.5C8.27513 13.5 7.6875 14.0876 7.6875 14.8125H6.1875Z"
              fill="#DCDDE0"
            ></path>
          </svg>
          نمایشگاه
        </span>
        <slot name="card_header_badge" />
      </nuxt-link>
      <div class="advert__body">
        <div class="advert__header">
          <nuxt-link :to="link" class="advert__name">{{
            advert.title
          }}</nuxt-link>
          <span class="advert__date">{{ TimeAgo(advert.creationDate) }}</span>
          <span class="advert__date-wide">{{
            TimeAgo(advert.creationDate)
          }}</span>
        </div>
        <div class="advert__info text-center">
          <span>مدل {{ advert.year }}</span>
          <span>{{ advert.mileage }} کیلومتر</span>
          <span>{{ advert.gearBox.toString().replace("_", " ") }}</span>
        </div>
        <span class="advert__location">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <mask id="path-1-inside-1_778_1497" fill="white">
              <path
                d="M0.116713 8C0.904956 11.9994 5.0979 14.5604 7.02718 15.544C7.64323 15.8581 8.35678 15.8581 8.97283 15.544C10.9021 14.5604 15.0951 11.9994 15.8833 8C16.5402 4.66667 14.4919 0 8 0C1.50811 0 -0.54026 4.66667 0.116713 8Z"
              ></path>
            </mask>
            <path
              d="M0.116713 8C0.904956 11.9994 5.0979 14.5604 7.02718 15.544C7.64323 15.8581 8.35678 15.8581 8.97283 15.544C10.9021 14.5604 15.0951 11.9994 15.8833 8C16.5402 4.66667 14.4919 0 8 0C1.50811 0 -0.54026 4.66667 0.116713 8Z"
              stroke="#0F0F10"
              stroke-width="2.4"
              stroke-linecap="round"
              stroke-linejoin="round"
              mask="url(#path-1-inside-1_778_1497)"
            ></path>
            <circle
              r="2.06667"
              transform="matrix(-1 0 0 1 8.00033 6.66667)"
              stroke="#0F0F10"
              stroke-width="1.2"
            ></circle>
          </svg>
          {{ advert.city }}، {{ advert.province }}
        </span>
        <slot name="text" />
        <div class="advert__footer">
          <template v-if="showPrice">
            <div
              class="advert__wrapper"
              v-if="
                advert.price.advertisementPaymentType ==
                AdvertisementPaymentType.قسطی
              "
            >
              <p class="advert__price">
                {{ splitNumber(advert.price.ghest?.pishPardakht) }}
                <span>پیش</span>
              </p>
              <p class="advert__price">
                {{ splitNumber(advert.price.ghest?.amountPricePerGhest) }}

                <span>ماهیانه</span>
              </p>
            </div>
            <div class="advert__wrapper" v-else>
              <p class="advert__price" v-if="advert.price.amount > 0">
                {{ splitNumber(advert.price.amount) }}
                <span>تومان</span>
              </p>
              <p class="advert__price" v-else>
                <span class="d-mobile-none"
                  >برای اطلاع از قیمت تماس بگیرید</span
                >
                <span class="d-mobile-block">توافقی</span>
              </p>
            </div>
          </template>
          <div v-else class="advert__wrapper"></div>
          <div>
            <slot name="actions" />
          </div>
        </div>
      </div>
    </div>
    <advert-custom-card-mobile :advert="advert" v-else :show-price="showPrice">
      <template #text v-if="$slots.text">
        <slot name="text" />
      </template>
      <template #actions v-if="$slots.actions">
        <slot name="actions" />
      </template>
    </advert-custom-card-mobile>
  </div>
</template>

<script setup lang="ts">
import { split } from "lodash";
import { AdvertisementFilterData } from "~~/models/advertisements/Advertisement.Models";
import { AdvertisementCard } from "~~/models/advertisements/AdvertisementCard";
import { AdvertisementPaymentType } from "~~/models/advertisements/enums/AdvertisementPaymentType";
import { TimeAgo } from "~~/utilities/dateUtil";
import { GetAdvertImage, GetBitMapAdvertImage } from "~~/utilities/imageUtil";
import { splitNumber } from "~~/utilities/numberUtils";

const link = ref("");
const isMobile = ref(false);
const { advert, showPrice = true } = defineProps<{
  advert: AdvertisementCard | AdvertisementFilterData;
  showPrice: boolean;
}>();

if (advert.isCar) {
  link.value = `/car/detail-${advert.shortLink}-${advert.brand_Model}`;
  if (advert.trim) {
    link.value += `-${advert.trim}`;
  }
} else {
  link.value = `/motorcycle/detail-${advert.shortLink}-${advert.brand_Model}`;
  if (advert.trim) {
    link.value += `-${advert.trim}`;
  }
}

onMounted(() => {
  if (window.innerWidth <= 992) {
    isMobile.value = true;
  }
});
</script>

<style scoped>
a:-webkit-any-link {
  color: inherit;
}
.advert__price {
  font-family: var(--t2-font-family) !important;
  font-size: var(--t2-font-size) !important;
}
.advert__price span {
  font-family: var(--t5-font-family) !important;
  font-size: var(--t5-font-size) !important;
}
.advert__wrapper {
  margin-right: unset !important;
}
.advert__banner {
  width: fit-content !important;
}
</style>